<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>punchclock</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="sqlite3.wasm"></script>
    <script type="text/javascript" src="jquery370.js"></script>
    <style type="text/css">
    html {
        background-color: #001524;
        color: #ffecd1;
        font-family: monospace;
        font-size: 12pt;
        margin: 0;
        display: flex;
        justify-content: center;.

        /* alt-colors:
        #ffffc7
        #473335
        variablen noch setzen!!! */


    }

    body {
    	aspect-ratio: 4/3;
        max-width: 600px;
        padding: 3em;
        margin: 3em;
        border: 2px dashed #ffecd1;
    }

    h1,
    h2,
    h3 {
        font-weight: normal;
        font-size: 12pt;
        margin-block-start: 0;
        margin-block-end: 0;
    }

    i {
    	padding-right: 8px;
    }

    .inactive {
        cursor: pointer;
        opacity: 30%;
    }

    .inactive:hover {
        opacity: 100%;
    }

    .buttoncontainer {
        width: 100%;
        display: flex;

    }

    button {
        background-color: #001524;
        color: #ffecd1;
        font-family: monospace;
        font-size: 12pt;
        padding: 1em 2em;
        cursor: pointer;
        border: 2px dashed #ffecd1;
        margin: 1.5em auto 0 auto;
    }

    button:hover,
    .clicked {
        background-color: #ffecd1;
        color: #001524;
        border: 2px dashed #001524;
    }

    #timespent {
        text-align: center;
    }

    .hidden {
        display: none;
    }

    .tabbed {
        padding-left: 2ch;
    }

    .separator {
        width: 100%;
        border: none;
        border-bottom: 2px dashed #ffecd1;
        padding: 0;
        margin: 1.5em 0;
    }
    </style>
    <script type="text/javascript">
	var start;
    var currentProject;
    var clockedIn = false;

    $(document).ready(function() {
        currentProject = $('.active').text()
        loadStats();
        console.log('currentProject: ', currentProject)

    	$('body').on('focus keydown', 'input[name="projectname"]', function(e) {
    		if(e.code == "Space") {
    			e.preventDefault();
    			$('input["projectname"]').val($('input["projectname"]').val() + '-')
    		}
    	});

        setInterval(updateTimeSpent, 1000);

    });

    function updateTimeSpent() {
        if (clockedIn) {
            var now = new Date()
            var diff = now - start;
            $('#timespent').text('spent ' + dateToString(diff) + ' on ' + currentProject);
        }
    }
    

    function changeProject(element) {
    	if(!$(element).hasClass("active")) {
            console.log("changing project from " + currentProject + " to "+ $(element).text());
            currentProject = $(element).text();
            $('.project').not(element).removeClass('active');
            $('.project').not(element).addClass('inactive');
    		$(element).removeClass("inactive");
    		$(element).addClass("active");
    	}

        loadStats();
    }

    function loadStats() {
        $("#statheader").html('> stats for ' + currentProject)
    }

    function clockIn() {
        currentProject = $(".active").text();
        clockedIn = true;
        start = new Date();
        console.log('started at', start);
        $('#start').html('clocked in...');
        $('#start').addClass('clicked');
        $('.project, #projectheader').addClass('hidden');
        $('#timespent').removeClass('hidden');
        // if timespent has a value, remove it and start anew unless it is the same project. 
    }

    function clockOut() {
        clockedIn = false;
        end = new Date();
        duration = end - start
        console.log(duration)
        $('#start').html('clock in');
        $('#start').removeClass('clicked');
        $('.project, #projectheader').removeClass('hidden');
    }

    function dateToString(ms) {
            var hours = Math.floor(ms / (1000 * 60 * 60));
            var minutes = Math.floor((ms / (1000 * 60)) % 60);
            var seconds = Math.floor((ms / 1000) % 60);

            var hours = hours.toString().padStart(2, '0');
            var minutes = minutes.toString().padStart(2, '0');
            var seconds = seconds.toString().padStart(2, '0');

            return timeSpent = hours + "h " + minutes + "m " + seconds + "s";
    }

    </script>
</head>

<body>
    <h1><i class="ph-bold ph-timer"></i>punchclock</h1><br>
    <!--p class="inactive">+ add new project</p>
    <input type="text" class="" name="projectname" hint="project name"></input-->
    <p id="projectheader">> select project</p>
    <span class="project inactive" onclick="changeProject(this)">project-1</span>
    <span class="project active" onclick="changeProject(this)">project-2</span>
    <span class="project inactive" onclick="changeProject(this)">project-3</span>
    <span class="project inactive" onclick="changeProject(this)">project-4</span>
    <span class="project inactive" onclick="changeProject(this)">project-5</span>
    </hr>
    <div class="buttoncontainer">
        <button id="start" onclick="clockIn()">clock in</button>
        <button id="stop" onclick="clockOut()">clock out</button>
    </div>
    <p id="timespent" class="hidden">spent 00h 00m 00s on {project-2}</p>
    <hr class="separator">
    <p id="statheader">> stats for {project-2}
        <div class="tabbed">
            <p id="goal">time goal: 00h 00m 00s (remaining: 00h 00m 00s)</p>
            <p id="timetotalmonth"> 00h 00m 00s spent this month</p>
            <p id="timetotal"> 00h 00m 00s spent in total</p>
        </div>
</body>

</html>